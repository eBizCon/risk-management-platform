{
  "source_skill": "plan-user-story-implementation-blueprint",
  "user_story": {
    "title": "Bestätigungsdialog für Antragseinreichung",
    "as_a": "Antragsteller",
    "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
    "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
  },
  "global_constraints": [
    "Verwende TailwindCSS für Styling (keine custom CSS in <style> tags)",
    "Verwende bestehende Design-Tokens aus app.css (@theme)",
    "Verwende Svelte 5 Runes ($state, $derived, $props)",
    "Füge data-testid Attribute für E2E-Tests hinzu",
    "Keine Backend-Änderungen (Server Actions, API Endpoints, Repositories bleiben unverändert)",
    "Keyboard-Navigation muss unterstützt werden (ESC = Abbrechen, Enter = Bestätigen)",
    "Dialog muss modal sein (blockiert Interaktion mit Rest der Seite)",
    "Body-Scroll muss verhindert werden wenn Dialog offen ist"
  ],
  "tasks": [
    {
      "id": "T-001",
      "title": "ConfirmDialog Komponente erstellen",
      "user_story": {
        "title": "Bestätigungsdialog für Antragseinreichung",
        "as_a": "Antragsteller",
        "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
        "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
      },
      "constraints": [
        "Verwende TailwindCSS für Styling (keine custom CSS in <style> tags)",
        "Verwende bestehende Design-Tokens aus app.css (@theme)",
        "Verwende Svelte 5 Runes ($state, $derived, $props)",
        "Füge data-testid Attribute für E2E-Tests hinzu",
        "Keyboard-Navigation muss unterstützt werden (ESC = Abbrechen, Enter = Bestätigen)",
        "Dialog muss modal sein (blockiert Interaktion mit Rest der Seite)",
        "Body-Scroll muss verhindert werden wenn Dialog offen ist",
        "Focus-Trap: Focus bleibt im Dialog",
        "Wenn open wechselt zu true, setze Focus auf Confirm-Button",
        "Click auf Dialog-Inhalt soll nicht schließen (nur Backdrop oder Buttons)"
      ],
      "goal": "Wiederverwendbare ConfirmDialog.svelte Komponente mit modal, backdrop, keyboard navigation und accessibility features",
      "blueprint_references": [
        "Abschnitt 4.1: Neue Komponente ConfirmDialog.svelte",
        "Abschnitt 3: Impact Map - Neue Komponenten"
      ],
      "implementation_details": [
        "Erstelle src/lib/components/ConfirmDialog.svelte",
        "Props Interface: open (boolean), title (optional string), message (string), confirmText (optional string), cancelText (optional string), onConfirm (function), onCancel (function)",
        "Wenn open === false, rendere nichts (early return)",
        "Rendere Overlay (backdrop) mit click handler → onCancel()",
        "Rendere Dialog-Container (zentriert, modal)",
        "Rendere Titel (optional, nur wenn vorhanden)",
        "Rendere Message",
        "Rendere Button-Gruppe: Abbrechen-Button (btn-secondary) → onCancel(), Bestätigen-Button (btn-primary) → onConfirm()",
        "Keyboard-Handler: ESC → onCancel(), Enter → onConfirm()",
        "Focus-Trap implementieren: Focus bleibt im Dialog",
        "Wenn open wechselt zu true, setze Focus auf Confirm-Button",
        "Verhindere Body-Scroll wenn Dialog offen ist",
        "Click auf Dialog-Inhalt soll nicht schließen (nur Backdrop oder Buttons)"
      ],
      "scope": [
        "Erstelle neue Svelte-Komponente ConfirmDialog.svelte",
        "Implementiere Props Interface mit Svelte 5 Runes",
        "Implementiere Modal-Overlay mit Backdrop",
        "Implementiere Keyboard-Navigation (ESC, Enter)",
        "Implementiere Focus-Management und Focus-Trap"
      ],
      "out_of_scope": [
        "Integration in bestehende Seiten (separate Tasks)",
        "E2E-Tests (separate Tasks)",
        "Backend-Änderungen"
      ],
      "artifacts": [
        "src/lib/components/ConfirmDialog.svelte"
      ],
      "acceptance_criteria": [
        "ConfirmDialog.svelte existiert in src/lib/components/",
        "Komponente akzeptiert alle definierten Props (open, title, message, confirmText, cancelText, onConfirm, onCancel)",
        "Dialog wird nur angezeigt wenn open === true",
        "Backdrop ist sichtbar und klickbar (führt zu onCancel)",
        "Dialog-Container ist zentriert und modal",
        "Buttons verwenden btn-primary und btn-secondary Klassen aus app.css",
        "ESC-Taste ruft onCancel auf",
        "Enter-Taste ruft onConfirm auf",
        "Focus wird auf Confirm-Button gesetzt wenn Dialog öffnet",
        "Body-Scroll ist deaktiviert wenn Dialog offen ist",
        "data-testid Attribute sind vorhanden: confirm-dialog, confirm-dialog-confirm, confirm-dialog-cancel"
      ],
      "checks": [
        "npm run dev - Komponente kann importiert werden ohne Fehler",
        "Manuelle Prüfung: Dialog öffnet und schließt korrekt",
        "Manuelle Prüfung: Keyboard-Navigation funktioniert (ESC, Enter)",
        "Manuelle Prüfung: Focus-Management funktioniert",
        "Manuelle Prüfung: Body-Scroll ist blockiert wenn Dialog offen"
      ],
      "notes": [
        "Styling: Backdrop: fixed inset-0 bg-black/50 z-40",
        "Styling: Dialog: fixed inset-0 z-50 flex items-center justify-center p-4",
        "Styling: Card: card p-6 max-w-md w-full shadow-xl",
        "Default-Werte: confirmText='Bestätigen', cancelText='Abbrechen'"
      ]
    },
    {
      "id": "T-002",
      "title": "ApplicationForm.svelte mit ConfirmDialog integrieren",
      "user_story": {
        "title": "Bestätigungsdialog für Antragseinreichung",
        "as_a": "Antragsteller",
        "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
        "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
      },
      "constraints": [
        "Verwende TailwindCSS für Styling (keine custom CSS in <style> tags)",
        "Verwende Svelte 5 Runes ($state, $derived, $props)",
        "Füge data-testid Attribute für E2E-Tests hinzu",
        "Keine Backend-Änderungen",
        "Save-Button (Entwurf) soll weiterhin ohne Dialog funktionieren",
        "Bei Validierungsfehlern bleibt Dialog geschlossen"
      ],
      "goal": "ApplicationForm zeigt ConfirmDialog vor Submit-Aktion, Save-Draft funktioniert weiterhin ohne Dialog",
      "blueprint_references": [
        "Abschnitt 4.2: Änderung ApplicationForm.svelte",
        "Abschnitt 3: Impact Map - Geänderte Komponenten"
      ],
      "implementation_details": [
        "Öffne src/lib/components/ApplicationForm.svelte",
        "Importiere ConfirmDialog Komponente",
        "Füge neue State-Variablen hinzu: showConfirmDialog = $state(false), pendingAction = $state<'submit' | null>(null)",
        "Erstelle handleSubmitClick(event: Event) Methode: preventDefault(), prüfe ob action === 'submit', wenn ja: setze showConfirmDialog = true und pendingAction = 'submit', wenn nein (save): lasse Form normal submitten",
        "Erstelle handleConfirmSubmit() Methode: setze showConfirmDialog = false, triggere Form-Submit programmatisch mit action='submit'",
        "Erstelle handleCancelSubmit() Methode: setze showConfirmDialog = false, setze pendingAction = null",
        "Ändere Submit-Button: type='button' (statt submit), onclick={handleSubmitClick}",
        "Füge ConfirmDialog am Ende des Templates hinzu mit Props: open={showConfirmDialog}, message='Möchten Sie diesen Antrag wirklich einreichen? Nach der Einreichung ist keine Bearbeitung mehr möglich.', confirmText='Antrag einreichen', cancelText='Abbrechen', onConfirm={handleConfirmSubmit}, onCancel={handleCancelSubmit}"
      ],
      "scope": [
        "Importiere ConfirmDialog in ApplicationForm.svelte",
        "Füge State-Management für Dialog hinzu",
        "Implementiere Event-Handler für Submit-Button",
        "Implementiere Confirm/Cancel Handler",
        "Integriere ConfirmDialog in Template"
      ],
      "out_of_scope": [
        "Änderungen an Validierungslogik",
        "Änderungen an Server Actions",
        "E2E-Tests (separate Tasks)"
      ],
      "artifacts": [
        "src/lib/components/ApplicationForm.svelte (geändert)"
      ],
      "acceptance_criteria": [
        "ConfirmDialog wird importiert",
        "State-Variablen showConfirmDialog und pendingAction existieren",
        "Submit-Button hat type='button' und onclick Handler",
        "Save-Draft-Button funktioniert weiterhin ohne Dialog",
        "Dialog öffnet sich nur beim Klick auf Submit-Button",
        "Dialog zeigt korrekte Message und Button-Texte",
        "Bei Bestätigung wird Form mit action='submit' abgeschickt",
        "Bei Abbruch bleibt Form unverändert und Dialog schließt"
      ],
      "checks": [
        "npm run dev - Keine Kompilierungsfehler",
        "Manuelle Prüfung auf /applications/new: Submit-Button öffnet Dialog",
        "Manuelle Prüfung: Save-Draft funktioniert ohne Dialog",
        "Manuelle Prüfung: Dialog-Bestätigung reicht Antrag ein",
        "Manuelle Prüfung: Dialog-Abbruch behält Formulardaten"
      ],
      "notes": [
        "ApplicationForm wird an 2 Stellen verwendet: /applications/new und /applications/[id]/edit",
        "Diese Änderung betrifft beide Stellen automatisch"
      ]
    },
    {
      "id": "T-003",
      "title": "Detailseite /applications/[id]/+page.svelte mit ConfirmDialog integrieren",
      "user_story": {
        "title": "Bestätigungsdialog für Antragseinreichung",
        "as_a": "Antragsteller",
        "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
        "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
      },
      "constraints": [
        "Verwende TailwindCSS für Styling (keine custom CSS in <style> tags)",
        "Verwende Svelte 5 Runes ($state, $derived, $props)",
        "Füge data-testid Attribute für E2E-Tests hinzu",
        "Keine Backend-Änderungen",
        "Ersetze bestehenden confirm() Dialog",
        "Bisheriges Verhalten nach Einreichung beibehalten (reload)"
      ],
      "goal": "Detailseite zeigt ConfirmDialog statt confirm() beim Einreichen, API-Call erfolgt nur nach Bestätigung",
      "blueprint_references": [
        "Abschnitt 4.3: Änderung /applications/[id]/+page.svelte",
        "Abschnitt 3: Impact Map - Geänderte Komponenten"
      ],
      "implementation_details": [
        "Öffne src/routes/applications/[id]/+page.svelte",
        "Importiere ConfirmDialog Komponente",
        "Füge neue State-Variable hinzu: showConfirmDialog = $state(false)",
        "Ändere handleSubmit() Methode: Entferne confirm() Zeile (ca. Zeile 36), setze stattdessen showConfirmDialog = true",
        "Erstelle neue handleConfirmSubmit() Methode: setze showConfirmDialog = false, führe API-Call aus (fetch /api/applications/${app.id}/submit mit POST), bei response.ok: window.location.reload(), bei Fehler: optional Fehlerbehandlung",
        "Erstelle neue handleCancelSubmit() Methode: setze showConfirmDialog = false",
        "Ändere Button onclick (ca. Zeile 79): onclick={() => showConfirmDialog = true} statt onclick={handleSubmit}",
        "Füge ConfirmDialog am Ende des Templates hinzu mit Props: open={showConfirmDialog}, message='Möchten Sie diesen Antrag wirklich einreichen? Nach der Einreichung ist keine Bearbeitung mehr möglich.', confirmText='Antrag einreichen', cancelText='Abbrechen', onConfirm={handleConfirmSubmit}, onCancel={handleCancelSubmit}"
      ],
      "scope": [
        "Importiere ConfirmDialog in /applications/[id]/+page.svelte",
        "Ersetze confirm() durch ConfirmDialog State-Management",
        "Refactore handleSubmit zu handleConfirmSubmit",
        "Implementiere handleCancelSubmit",
        "Integriere ConfirmDialog in Template"
      ],
      "out_of_scope": [
        "Änderungen an API Endpoint /api/applications/[id]/submit",
        "Änderungen an Fehlerbehandlung (optional)",
        "E2E-Tests (separate Tasks)"
      ],
      "artifacts": [
        "src/routes/applications/[id]/+page.svelte (geändert)"
      ],
      "acceptance_criteria": [
        "ConfirmDialog wird importiert",
        "State-Variable showConfirmDialog existiert",
        "confirm() Dialog ist entfernt (Zeile 36)",
        "Button 'Einreichen' öffnet ConfirmDialog statt confirm()",
        "Dialog zeigt korrekte Message und Button-Texte",
        "Bei Bestätigung wird API-Call ausgeführt und Seite reloaded",
        "Bei Abbruch bleibt Seite unverändert und Dialog schließt",
        "Bisheriges Verhalten nach erfolgreicher Einreichung bleibt erhalten"
      ],
      "checks": [
        "npm run dev - Keine Kompilierungsfehler",
        "Manuelle Prüfung: Draft erstellen und zur Detailseite navigieren",
        "Manuelle Prüfung: Button 'Einreichen' öffnet Dialog",
        "Manuelle Prüfung: Dialog-Bestätigung reicht Antrag ein und reloaded Seite",
        "Manuelle Prüfung: Dialog-Abbruch behält Draft-Status",
        "Manuelle Prüfung: Nach Einreichung ist Status 'submitted' und Edit-Button nicht mehr sichtbar"
      ],
      "notes": [
        "Bestehender confirm() Dialog in Zeile 36 muss entfernt werden",
        "API-Call an /api/applications/[id]/submit bleibt unverändert"
      ]
    },
    {
      "id": "T-004",
      "title": "E2E-Tests für ConfirmDialog erstellen",
      "user_story": {
        "title": "Bestätigungsdialog für Antragseinreichung",
        "as_a": "Antragsteller",
        "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
        "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
      },
      "constraints": [
        "Verwende Playwright für E2E-Tests",
        "Verwende bestehende Fixtures (authenticatedPage)",
        "Teste alle 3 Einreichungsstellen",
        "Teste Keyboard-Navigation (ESC)",
        "Teste Bestätigung und Abbruch"
      ],
      "goal": "6 neue E2E-Tests für ConfirmDialog an allen Einreichungsstellen mit Bestätigung, Abbruch und Keyboard-Navigation",
      "blueprint_references": [
        "Abschnitt 6: Testplan - E2E Tests",
        "Abschnitt 3: Impact Map - E2E-Tests"
      ],
      "implementation_details": [
        "Öffne e2e/applicant.test.ts",
        "Füge Test 1 hinzu: 'should show confirmation dialog when submitting new application' - navigiere zu /applications/new, fülle Felder aus, klicke Submit, prüfe Dialog-Sichtbarkeit und Buttons",
        "Füge Test 2 hinzu: 'should submit application after confirming dialog' - wie Test 1, aber bestätige Dialog, prüfe Redirect zu /applications/[id] und Status 'submitted', prüfe Dialog ist geschlossen",
        "Füge Test 3 hinzu: 'should not submit application when canceling dialog' - wie Test 1, aber breche Dialog ab, prüfe noch auf /applications/new, Dialog geschlossen, Daten erhalten",
        "Füge Test 4 hinzu: 'should show confirmation dialog when submitting from edit page' - erstelle Draft, navigiere zu Edit-Seite, klicke Submit, prüfe Dialog",
        "Füge Test 5 hinzu: 'should show confirmation dialog when submitting from detail page' - erstelle Draft, auf Detailseite, klicke Einreichen-Button, prüfe Dialog",
        "Füge Test 6 hinzu: 'should close dialog when pressing ESC key' - öffne Dialog, drücke ESC, prüfe Dialog geschlossen und noch auf /applications/new"
      ],
      "scope": [
        "Erstelle 6 neue E2E-Tests in e2e/applicant.test.ts",
        "Teste Dialog-Anzeige an allen 3 Einreichungsstellen",
        "Teste Bestätigung führt zu Einreichung",
        "Teste Abbruch verhindert Einreichung",
        "Teste ESC-Taste schließt Dialog"
      ],
      "out_of_scope": [
        "Änderungen an bestehenden Tests (separate Task)",
        "Unit-Tests (nicht erforderlich)",
        "Integration-Tests (nicht erforderlich)"
      ],
      "artifacts": [
        "e2e/applicant.test.ts (6 neue Tests hinzugefügt)"
      ],
      "acceptance_criteria": [
        "Test 1 'should show confirmation dialog when submitting new application' existiert und ist grün",
        "Test 2 'should submit application after confirming dialog' existiert und ist grün",
        "Test 3 'should not submit application when canceling dialog' existiert und ist grün",
        "Test 4 'should show confirmation dialog when submitting from edit page' existiert und ist grün",
        "Test 5 'should show confirmation dialog when submitting from detail page' existiert und ist grün",
        "Test 6 'should close dialog when pressing ESC key' existiert und ist grün",
        "Alle 6 Tests verwenden data-testid: confirm-dialog, confirm-dialog-confirm, confirm-dialog-cancel"
      ],
      "checks": [
        "npx playwright test e2e/applicant.test.ts --grep 'confirmation dialog' - Alle neuen Tests sind grün",
        "npm run test:e2e - Alle E2E-Tests laufen durch"
      ],
      "notes": [
        "Tests müssen nach T-001, T-002 und T-003 ausgeführt werden",
        "Verwende bestehende Test-Patterns aus applicant.test.ts"
      ]
    },
    {
      "id": "T-005",
      "title": "Bestehende E2E-Tests anpassen für ConfirmDialog",
      "user_story": {
        "title": "Bestätigungsdialog für Antragseinreichung",
        "as_a": "Antragsteller",
        "i_want": "vor jeder Antragseinreichung einen Bestätigungsdialog sehen",
        "so_that": "ich versehentliche Einreichungen vermeiden und meine Entscheidung bewusst bestätigen kann"
      },
      "constraints": [
        "Verwende Playwright für E2E-Tests",
        "Passe nur Tests an die Submit-Aktionen betreffen",
        "Behalte bestehende Test-Logik bei, füge nur Dialog-Interaktion hinzu"
      ],
      "goal": "2 bestehende E2E-Tests anpassen um ConfirmDialog-Interaktion zu berücksichtigen",
      "blueprint_references": [
        "Abschnitt 6: Testplan - Bestehende Tests anpassen",
        "Abschnitt 3: Impact Map - E2E-Tests"
      ],
      "implementation_details": [
        "Öffne e2e/applicant.test.ts",
        "Finde Test 'should submit a draft application' (ca. Zeile 160-176)",
        "Ersetze Zeilen 171-175 (dialog.accept() Code) durch: await authenticatedPage.getByTestId('submit-application').click(), await expect(authenticatedPage.getByTestId('confirm-dialog')).toBeVisible(), await authenticatedPage.getByTestId('confirm-dialog-confirm').click(), await expect(authenticatedPage.getByTestId('status-badge-submitted')).toBeVisible()",
        "Finde Test 'should successfully create and submit an application directly' (ca. Zeile 96-110)",
        "Nach Zeile 106 (btn-submit-application.click()) füge hinzu: await expect(authenticatedPage.getByTestId('confirm-dialog')).toBeVisible(), await authenticatedPage.getByTestId('confirm-dialog-confirm').click()"
      ],
      "scope": [
        "Passe Test 'should submit a draft application' an",
        "Passe Test 'should successfully create and submit an application directly' an",
        "Ersetze dialog.accept() durch ConfirmDialog-Interaktion"
      ],
      "out_of_scope": [
        "Neue Tests erstellen (separate Task T-004)",
        "Änderungen an Tests die keine Submit-Aktion haben"
      ],
      "artifacts": [
        "e2e/applicant.test.ts (2 Tests geändert)"
      ],
      "acceptance_criteria": [
        "Test 'should submit a draft application' verwendet ConfirmDialog statt dialog.accept()",
        "Test 'should successfully create and submit an application directly' wartet auf ConfirmDialog und bestätigt ihn",
        "Beide angepassten Tests sind grün",
        "Keine anderen Tests sind betroffen oder kaputt"
      ],
      "checks": [
        "npx playwright test e2e/applicant.test.ts --grep 'should submit a draft application' - Test ist grün",
        "npx playwright test e2e/applicant.test.ts --grep 'should successfully create and submit an application directly' - Test ist grün",
        "npm run test:e2e - Alle E2E-Tests laufen durch"
      ],
      "notes": [
        "Diese Tests müssen nach T-001, T-002 und T-003 angepasst werden",
        "Alte dialog.accept() Logik funktioniert nicht mehr mit ConfirmDialog"
      ]
    }
  ]
}
